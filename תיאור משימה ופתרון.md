תיאור משימה ופתרון


נדרש לממש האזנה לנתוני מיקום שמגיעים מהשירות, ולהציג על המפה באופן בהיר על מנת לאפשר מעקב אחרי הכלב, וכן אפשרות להוספה ידנית של מיקומים ועדכונם בשרת.

הפתרון: אפליקציית ריאקט, ניהול סטייט עם ספריית zustand, מפה של mapLibre, דאטה בפורמט JeoJSON, מבנה הדאטה: 1) רשימת הנקודות שהתקבלו, 2) הנקודה האחרונה בנפרד, 3) קו התקדמות (נגזר מהנקודות)

מבנה כללי של src:
components: Map, PathLayer, ContextMenu

hooks: useSSE

services: api

stores: mapStore, pathStore

types: index

שיקולים:

ככלל השתדלתי לשמור על קוד קצר, קליל,  לא מסורבל. Zustand נבחה לניהול הסטייט בעיקר מהסיבה הזו וגם כדי להתנסות במשהו שלא הכרתי.

מודולריות: הפרדה בין שכבת של עבודה מול שרת, שכבה של  useEffect hooks שמשתמשת בה, ושכבה של קומפוננטות (מפה, עדכון המסלול, הוספה ידנית) שמשתמשת בhooks ובסטור.

מבנה הדאטה במפה נגזר מהשימוש העסקי עצמו. כלומר, מכיון שמה שחשוב לנו הוא לשקף את מסלול הכלב לשם מעקב, לצורך זה יש להראות איפה הוא כעת ואיפה היה לאחרונה.

מבחינת מבנה הנקודה הבודדת: התחלתי עם משהו אינטאיטיבי שנגזר ממה שהשרת שולח, ובמהלך העבודה, לצורך הפשטות נירמלתי למבנה של  GeoJSON.Feature 
המכיל בתוכו GeoJSON.Point וכן נתונים נוספים בתור properties

מבחינת ניהול סטייט יש רק עדכון של הסטור כאשר מגיעה נקודה חדשה, וצריכה של המידע לצורך עדכון המפה עצמה. 

עדכון של הסטור נעשה בכל פעם על ידי דריסת הכל עם הדאטה המעודכנת. זה פשוט יותר לניהול וכן מונע באגים ואי בהירות בקוד. מבחינת ביצועים: בשלב זה עדיין לא נדרש להתחשב. לוגיקת JS היא זולה, ואני משער שהספריה עצמה מעדיפה דריסה. לא הוספתי debaunc מכיון שכרגע קצב ההודעות מהשירות הוא 2 שניות.

ככלל העדפתי להשתמש בפיצ'רים נייטיביים של המפה ונעזרתי בתיעוד של Maplibre. כמו כן את הלוגיקה של המפה, למרות שהיא די ארוכה לא פירקתי כדי שתישאר מרוכזת במקום אחד. כדי להקל על שינויים, כל סוג אלמנט מנוהל ב- layer נפרד: path-line, last-point-layer, path-points-manual, path-points-system

שימוש ב- typescript בסגנון מתון

מבחינת UX, כדי להוסיף בהירות הוספתי לכל נקודה hover tooltip שמציג את הזמן + קואורדינטות. בציור המסלול סיננתי החוצה מידע ישן על מנת להוריד עומס מהיוזר (מציג מסלול של 5 דקות אחרונות בלבד). יש panTo לכל נקודה חדשה שמתווספת. להוספה ידנית יש tooltip לאישור וכן עדכון אופטימי (פידבק).

